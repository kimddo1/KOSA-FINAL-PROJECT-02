# 통계시각화 AI 분석 기능

이 기능은 지원자 통계 차트에 대한 **실제 LLM 모델(GPT-4o-mini)**을 사용한 AI 기반 해석 및 분석 결과를 제공합니다.

## 🎯 기능 개요

각 통계 차트별로 **GPT-4o-mini 모델**이 데이터를 분석하여 다음과 같은 정보를 제공합니다:

- **기본 분석 결과**: 차트 데이터의 핵심 통계 정보
- **주요 인사이트**: 데이터에서 발견된 중요한 패턴과 의미
- **권장사항**: 채용 전략 개선을 위한 구체적인 제안

## 🤖 AI 모델 정보

- **모델**: GPT-4o-mini (OpenAI)
- **온도**: 0.3 (일관성 있는 분석을 위해 낮게 설정)
- **폴백**: LLM 사용 불가 시 규칙 기반 분석으로 자동 전환
- **캐싱**: 향후 Redis 캐싱 추가 예정

## 📊 지원하는 차트 타입

1. **지원 시기별 추이** (`trend`)
   - 일별 지원자 수 변화 분석
   - 피크 시기 및 추세 패턴 분석
   - 홍보 효과 및 지원자 유입 전략 제안

2. **연령대별 지원자** (`age`)
   - 주요 연령대 분석
   - 연령별 관심도 패턴 분석
   - 타겟 연령층 맞춤 전략 제안

3. **성별 지원자** (`gender`)
   - 성별 분포 분석
   - 다양성 및 포용성 평가
   - 균형잡힌 채용을 위한 제안

4. **학력별 지원자** (`education`)
   - 주요 학력 수준 분석
   - 고학력자 비율 분석
   - 학력별 맞춤 전략 제안

5. **지역별 지원자** (`province`)
   - 지역별 분포 분석
   - 수도권 vs 지방 비율 분석
   - 지역별 홍보 전략 제안

6. **자격증 보유 현황** (`certificate`)
   - 자격증 보유자 비율 분석
   - 전문성 수준 평가
   - 자격증 활용 전략 제안

## 🏗️ 아키텍처

### 백엔드 (FastAPI)

```
backend/app/api/v1/statistics_analysis.py
├── StatisticsAnalysisRequest (Pydantic 모델)
├── StatisticsAnalysisResponse (Pydantic 모델)
├── get_llm() - LLM 모델 초기화
├── analyze_with_llm() - LLM 기반 분석 (메인)
├── analyze_with_rules() - 규칙 기반 분석 (폴백)
├── analyze_trend_data() - 지원 시기별 추이 분석
├── analyze_age_data() - 연령대별 분석
├── analyze_gender_data() - 성별 분석
├── analyze_education_data() - 학력별 분석
├── analyze_province_data() - 지역별 분석
├── analyze_certificate_data() - 자격증 분석
└── analyze_statistics() - 메인 API 엔드포인트
```

### 프론트엔드 (React)

```
frontend/src/components/StatisticsAnalysis.jsx
├── AI 분석 결과 표시 컴포넌트
├── LLM 사용 여부 표시
├── 로딩 상태 관리
├── 에러 처리
├── 접기/펼치기 기능
└── 차트별 분석 결과 렌더링
```

## 🚀 사용 방법

### 1. 환경 변수 설정

`.env` 파일에 OpenAI API 키를 설정하세요:

```env
OPENAI_API_KEY=your_openai_api_key_here
```

### 2. 백엔드 서버 실행

```bash
cd backend
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

### 3. 프론트엔드 서버 실행

```bash
cd frontend
npm install
npm run dev
```

### 4. 통계 모달창 접근

1. 지원자 목록 페이지에서 통계 아이콘 클릭
2. 각 차트를 확인하면서 AI 분석 결과 확인
3. 분석 결과는 차트 아래에 자동으로 표시됨
4. 🤖 아이콘으로 LLM 사용 여부 확인 가능

## 📡 API 엔드포인트

### POST /statistics/analyze

통계 데이터에 대한 AI 분석을 제공합니다.

**요청 예시:**
```json
{
  "job_post_id": 1,
  "chart_type": "trend",
  "chart_data": [
    {"date": "2025-07-05", "count": 3},
    {"date": "2025-07-06", "count": 3},
    {"date": "2025-07-07", "count": 20}
  ]
}
```

**응답 예시:**
```json
{
  "analysis": "📊 **지원 시기별 추이 분석**\n\n**전체 지원자 수**: 26명\n**평균 일일 지원자 수**: 2.6명\n**최고 지원일**: 2025-07-07 (20명)\n**최저 지원일**: 2025-07-08 (1명)",
  "insights": [
    "📈 2025-07-07에 지원자가 급증했습니다. 이는 채용공고 게시나 홍보 활동의 효과일 수 있습니다.",
    "⚠️ 전체 지원자 수가 적습니다. 채용공고 홍보를 강화하는 것을 고려해보세요."
  ],
  "recommendations": [
    "🎯 피크 시기에 맞춰 추가 채용공고나 홍보를 계획해보세요.",
    "📢 채용공고 노출을 높이기 위해 다양한 채널을 활용해보세요."
  ],
  "is_llm_used": true
}
```

## 🧪 테스트

테스트 스크립트를 실행하여 API 기능을 확인할 수 있습니다:

```bash
python test_statistics_analysis.py
```

테스트 결과에서 LLM 사용 여부와 성능을 확인할 수 있습니다.

## 🎨 UI/UX 특징

### 디자인 요소
- **Material-UI 컴포넌트** 사용
- **🤖 LLM 사용 표시**: GPT-4o-mini 모델 사용 시 로봇 아이콘 표시
- **접기/펼치기 기능**으로 공간 효율성 확보
- **로딩 상태** 표시로 사용자 경험 개선
- **에러 처리** 및 사용자 친화적 메시지

### 색상 체계
- **분석 결과**: 파란색 (#1976d2)
- **인사이트**: 주황색 (#ff9800)
- **권장사항**: 초록색 (#4caf50)
- **LLM 표시**: 청록색 (#00bcd4)

### 아이콘
- 🧠 AI 분석 아이콘
- 🤖 LLM 모델 사용 표시
- 💡 인사이트 아이콘
- ✅ 권장사항 아이콘
- 📊 차트 타입별 아이콘

## 🔧 설정 및 커스터마이징

### LLM 모델 설정

`backend/app/api/v1/statistics_analysis.py`에서 모델 설정을 변경할 수 있습니다:

```python
def get_llm():
    return ChatOpenAI(
        model="gpt-4o-mini",  # 모델 변경 가능
        temperature=0.3,      # 온도 조정 가능
        api_key=api_key
    )
```

### 프롬프트 커스터마이징

각 차트 타입별 분석 프롬프트를 수정하여 더 정교한 분석을 제공할 수 있습니다:

```python
prompt = f"""
사용자 정의 프롬프트...
"""
```

### 프론트엔드 스타일링

`StatisticsAnalysis.jsx` 컴포넌트의 스타일을 수정하여 디자인을 커스터마이징할 수 있습니다:

```jsx
<Card 
  sx={{ 
    mt: 2, 
    backgroundColor: '#f8f9fa',  // 배경색 변경
    border: '1px solid #e0e0e0', // 테두리 변경
    borderRadius: 2
  }}
>
```

## 📈 성능 최적화

### LLM 호출 최적화
- **프롬프트 최적화**: 명확하고 간결한 프롬프트 사용
- **응답 파싱**: JSON 형식으로 구조화된 응답 요청
- **에러 처리**: LLM 실패 시 규칙 기반으로 자동 폴백

### 향후 개선 계획
- **Redis 캐싱**: 동일한 차트 데이터에 대한 중복 분석 방지
- **배치 처리**: 대용량 데이터 분석 시 백그라운드 작업
- **토큰 사용량 최적화**: 프롬프트 길이 및 응답 크기 최적화

## 🔮 향후 개선 계획

1. **더 정교한 AI 분석**
   - 머신러닝 모델을 활용한 예측 분석
   - 시계열 분석을 통한 트렌드 예측
   - 다중 모델 앙상블 분석

2. **인터랙티브 기능**
   - 분석 결과에 대한 사용자 피드백 수집
   - 맞춤형 분석 옵션 제공
   - 실시간 분석 결과 업데이트

3. **리포트 생성**
   - PDF 형태의 분석 리포트 생성
   - 이메일 발송 기능
   - 대시보드 통합

4. **다국어 지원**
   - 영어, 일본어 등 다국어 분석 결과 제공
   - 지역별 맞춤 분석

## 🐛 문제 해결

### 일반적인 문제들

1. **LLM 분석이 작동하지 않음**
   - OpenAI API 키가 올바르게 설정되었는지 확인
   - API 키 잔액 및 사용량 확인
   - 네트워크 연결 상태 확인

2. **API 연결 실패**
   - 백엔드 서버가 실행 중인지 확인
   - 포트 8000이 사용 가능한지 확인

3. **분석 결과가 표시되지 않음**
   - 차트 데이터가 올바른 형식인지 확인
   - 브라우저 개발자 도구에서 네트워크 오류 확인

4. **로딩이 계속됨**
   - LLM 응답 시간 확인 (일반적으로 2-5초)
   - 네트워크 연결 상태 확인
   - 서버 로그에서 오류 메시지 확인

### 디버깅 팁

```bash
# 백엔드 로그 확인
tail -f backend/logs/app.log

# LLM 사용 여부 확인
curl -X POST "http://localhost:8000/statistics/analyze" \
  -H "Content-Type: application/json" \
  -d '{"job_post_id": 1, "chart_type": "trend", "chart_data": [{"date": "2025-07-05", "count": 3}]}'

# 프론트엔드 개발자 도구
# Network 탭에서 API 요청/응답 확인
# Console 탭에서 JavaScript 오류 확인
```

## 💰 비용 고려사항

### OpenAI API 비용
- **GPT-4o-mini**: 입력 토큰당 $0.00015, 출력 토큰당 $0.0006
- **예상 비용**: 차트 분석당 약 $0.01-0.05 (데이터 크기에 따라)
- **월 예상 비용**: 1000회 분석 시 약 $10-50

### 비용 최적화 방법
- **프롬프트 최적화**: 불필요한 텍스트 제거
- **응답 길이 제한**: JSON 형식으로 구조화
- **캐싱 구현**: 동일 데이터 중복 분석 방지

## 📞 지원

기술적 문제나 개선 제안이 있으시면 이슈를 등록해주세요.

---

**버전**: 2.0.0 (LLM 통합)  
**최종 업데이트**: 2025년 1월  
**담당자**: AI 개발팀  
**LLM 모델**: GPT-4o-mini (OpenAI) 